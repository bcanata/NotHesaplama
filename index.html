<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Öğrenci Not Hesaplama</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-5">

<h2 class="text-2xl font-bold text-gray-800 mb-4">Öğrenci Toplam Not Hesaplama</h2>

<div class="mb-4">
  <button id="downloadBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
    Dosya Olarak İndir
  </button>
  <button id="clearTableBtn" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded ml-2">
    Tabloyu Temizle
  </button>
</div>

<div class="overflow-x-auto">
  <table id="scoresTable" class="table-auto w-full text-left whitespace-no-wrap">
    <tr class="text-gray-100 bg-gray-800">
      <th class="px-4 py-3 border-2 border-black w-10">Öğrenci No</th>
      <th class="px-4 py-3 border-2 border-black w-10">Öğrenci Adı Soyadı</th>
      <th class="px-4 py-3 border-2 border-black w-10">Yazılı</th>
      <th class="px-4 py-3 border-2 border-black w-10">Dinleme</th>
      <th class="px-4 py-3 border-2 border-black w-10">Konuşma</th>
      <th class="px-4 py-3 border-2 border-black w-10">Toplam Not</th>
    </tr>
  </table>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const table = document.getElementById('scoresTable');

  function loadScores() {
    const scores = JSON.parse(localStorage.getItem('scores')) || [];
    scores.forEach(score => addRow(score));
    if (!scores.length || scores[scores.length - 1].some(v => v)) addRow(); // Add blank row if last is filled
    calculateTotals(); // Calculate totals right after loading scores
  }

  function saveScores() {
    const scores = [];
    for (let i = 1; i < table.rows.length; i++) {
      const row = table.rows[i];
      const score = [...row.cells].slice(0, 5).map(cell => cell.firstChild.value || '');
      if (score.some(v => v)) scores.push(score);
    }
    localStorage.setItem('scores', JSON.stringify(scores));
  }

  function addRow(data = ['', '', '', '', '', '']) {
    const row = table.insertRow();
    row.className = "border-2 border-black"; // Add Tailwind CSS class for border
    for (let i = 0; i < 6; i++) {
      const cell = row.insertCell();
      cell.className = "px-4 py-3 border-2 border-black"; // Tailwind CSS classes for padding and border
      if (i < 5) {
        const input = document.createElement('input');
        input.type = "text";
        input.className = "w-full text-center"; // Tailwind CSS class for width and text alignment
        //input.style.maxWidth = "100px"; // Set a maxWidth for the input for a more compact design
        input.value = data[i];
        input.oninput = calculateTotals;
        cell.appendChild(input);
      } else {
        cell.textContent = data[i]; // This will be recalculated anyway
        cell.className += " w-32"; // Additional class for width
      }
    }
  }

  function calculateTotals() {
    for (let i = 1; i < table.rows.length; i++) {
      const row = table.rows[i];
      const exam1 = parseFloat(row.cells[2].firstChild.value) || 0;
      const exam2 = parseFloat(row.cells[3].firstChild.value) || 0;
      const exam3 = parseFloat(row.cells[4].firstChild.value) || 0;
      const total = (exam1 * 0.5) + (exam2 * 0.25) + (exam3 * 0.25);
      row.cells[5].textContent = total.toFixed(2);
    }
    saveScores();
  }

function downloadTableAsTxt() {
  let txtContent = "Öğrenci No | Öğrenci Adı-Soyadı | Yazılı | Dinleme | Konuşma | Toplam\n";
  // Iterate over table rows to construct the TXT content
  for (let i = 1; i < table.rows.length; i++) {
    let row = [...table.rows[i].cells].map(cell => cell.firstChild.value || cell.textContent);
    txtContent += row.join(" | ") + "\n";
  }
  // Create a Blob with TXT content
  const blob = new Blob([txtContent], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  // Create a temporary anchor to trigger the download
  const a = document.createElement('a');
  a.href = url;
  a.download = "Notlar.txt";
  document.body.appendChild(a); // Append anchor to body
  a.click(); // Trigger download
  document.body.removeChild(a); // Clean up
}

// Function to clear table after confirmation
function clearTable() {
  if (confirm("Tabloyu silmek istediğinizden emin misiniz? Verileri kaydetmediyseniz TAMAMEN silinecek.")) {
    localStorage.removeItem('scores'); // Clear stored data
    while (table.rows.length > 1) {
      table.deleteRow(1); // Delete all rows except the header
    }
    addRow(); // Add a blank row
  }
}

  table.addEventListener('input', () => {
    const lastRow = table.rows[table.rows.length - 1];
    const isLastRowFilled = [...lastRow.cells].slice(0, 5).some(cell => cell.firstChild.value);
    if (isLastRowFilled) addRow();
  });

// Attach event listeners to buttons
document.getElementById('downloadBtn').addEventListener('click', downloadTableAsTxt);
document.getElementById('clearTableBtn').addEventListener('click', clearTable);

  loadScores();
});

</script>
</body>
</html>
